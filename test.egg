
function getClosestNode(%position) {
	%nodeId = -1;
	%radius = 20;
	%minDistance = %radius;

	%room = getRoomFromPosition(%position);
	%count = %room.pathfindingBricks.getCount();
	for(%i = 0; %i < %count; %i++) {
		%brick = %room.pathfindingBricks.getObject(%i);
		if(
			(
				%brick.getName() $= "_node"
				|| %brick.getDatablock().getName() $= "BrickPathfindingNodeData"
			)
			&& (%distance = vectorDist(%brick.getPosition(), %position)) < %minDistance
		) {
			%raycast = containerRaycast(%position, %brick.getPosition(), $TypeMasks::fxBrickObjectType);
			if(getWord(%raycast, 0) == %brick) {
				%minDistance = %distance;
				%nodeId = %brick.nodeId;
			}
		}
	}
	return %nodeId;
}